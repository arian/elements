<!DOCTYPE html>
<html>
	<head>

		<meta charset="utf-8">
		<title>Testing</title>
		<link rel="stylesheet" href="./mocha.css" type="text/css">
		<script src="./mocha.js"></script>

	</head>
	<body>

		<div id="mocha"></div>

		<script>

			var m = new mocha
			m.ui('bdd')
			m._reporter = mocha.reporters.HTML
			m.loadFiles = function(){}
			m.suite.emit('pre-require', window)

			var script = document.createElement('script')
			script.src = './test.js' + location.search
			var loaded = false
			var load = function(){
				loaded = true
				var runner = m.run(function(failures){
					if (window.parent){
						parent.finish(location.search, failures)
					}
				})
			}
			script.onload = load
			script.onreadystatechange = function(){
				if (this.readyState == 'complete' || this.readyState == 'loaded') load()
			}

			document.body.appendChild(script)

		</script>

	</body>
</html>
